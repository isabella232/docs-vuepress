(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{665:function(e,t,a){"use strict";a.r(t);var s=a(0),r=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"authenticating-users"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#authenticating-users","aria-hidden":"true"}},[e._v("#")]),e._v(" Authenticating Users")]),e._v(" "),a("p",[e._v("Rundeck can be configured to use several mechanisms\nto authenticate a user, and determine the user's authorized roles.")]),e._v(" "),a("p",[e._v("Primarily these are:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#single-sign-on"}},[e._v("Single Sign On")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#jetty-and-jaas-authentication"}},[e._v("JAAS")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#container-authentication-and-authorization"}},[e._v("Container Authentication")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#preauthenticated-mode"}},[e._v("Preauthenticated Mode")])])]),e._v(" "),a("p",[e._v("For the default installation (Executable War, RPM, Deb),\nthe Servlet Container is Jetty,\nand the default security mechanism is JAAS,\nso you are free to use what ever JAAS provider\nyou feel is suitable for your environment.\nSee "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service",target:"_blank",rel:"noopener noreferrer"}},[e._v("JAAS"),a("OutboundLink")],1),e._v("\nand specifically for Jetty,\n"),a("a",{attrs:{href:"https://wiki.eclipse.org/Jetty/Feature/JAAS",target:"_blank",rel:"noopener noreferrer"}},[e._v("JAAS for Jetty"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("If you use the Rundeck war file with a different container, such as Tomcat, refer to "),a("a",{attrs:{href:"#container-authentication-and-authorization"}},[e._v("Container authentication and authorization")]),e._v(" below.")]),e._v(" "),a("h1",{attrs:{id:"single-sign-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#single-sign-on","aria-hidden":"true"}},[e._v("#")]),e._v(" Single Sign On")]),e._v(" "),a("p",[e._v("See "),a("router-link",{attrs:{to:"/administration/security/sso.html"}},[e._v("Security > Single Sign On")]),e._v(".")],1),e._v(" "),a("h1",{attrs:{id:"jetty-and-jaas-authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jetty-and-jaas-authentication","aria-hidden":"true"}},[e._v("#")]),e._v(" Jetty and JAAS authentication")]),e._v(" "),a("p",[e._v("Rundeck has three basic JAAS modules.")]),e._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"#propertyfileloginmodule"}},[e._v("PropertyFileLoginModule")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#ldap"}},[e._v("LDAP")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#pam"}},[e._v("PAM")])])]),e._v(" "),a("p",[e._v("By default a new installation uses the realm.properties method.")]),e._v(" "),a("p",[e._v("Each method determines whether the user is authenticated, and what "),a("em",[e._v("roles")]),e._v(" they have.")]),e._v(" "),a("p",[e._v("The list of roles can be accepted as-is (default), or you can add a prefix to them using the following config in rundeck-config.properties:")]),e._v(" "),a("pre",[a("code",[e._v("rundeck.security.jaasRolePrefix=PREFIX_\n")])]),e._v(" "),a("h2",{attrs:{id:"propertyfileloginmodule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#propertyfileloginmodule","aria-hidden":"true"}},[e._v("#")]),e._v(" PropertyFileLoginModule")]),e._v(" "),a("ul",[a("li",[e._v("NOTE: The "),a("code",[e._v("org.eclipse.jetty.jaas.spi.PropertyFileLoginModule")]),e._v(" JAAS module will automatically add the username as a role to the login credentials."),a("br"),e._v("\nIf you do not want this behavior please use the "),a("code",[e._v("org.rundeck.jaas.jetty.ReloadablePropertyFileLoginModule")]),e._v(" module.*")])]),e._v(" "),a("p",[e._v("These instructions explain how to manage user credentials for\nRundeck using a text file containing usernames, passwords and role definitions.\nUsually this file is called "),a("code",[e._v("realm.properties")]),e._v(".")]),e._v(" "),a("p",[e._v("The default Rundeck installation handles user authentication via\nJAAS using the realm.properties file.\nThis file is created at the time that you install the server.")]),e._v(" "),a("p",[e._v("Location:")]),e._v(" "),a("ul",[a("li",[e._v("Executable War: "),a("code",[e._v("$RDECK_BASE/server/config/realm.properties")])]),e._v(" "),a("li",[e._v("RPM/DEB: "),a("code",[e._v("/etc/rundeck/realm.properties")])])]),e._v(" "),a("p",[e._v("Assuming it wasn't modified, your realm.properties file will\nprobably look something like this:")]),e._v(" "),a("div",{staticClass:"language-bash .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# This file defines users passwords and roles for a HashUserRealm")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The format is")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#  <username>: <password>[,<rolename> ...]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Passwords may be clear text, obfuscated or checksummed.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# This sets the default user accounts for the Rundeck apps")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\nadmin:admin,user,admin\nuser:user,user\n")])])]),a("p",[a("em",[e._v("Adding additional users")])]),e._v(" "),a("p",[e._v("You may wish to have additional users with various privileges rather\nthan giving out role accounts to groups. You may also want to avoid\nhaving the passwords in plaintext within the configuration file.")]),e._v(" "),a("p",[e._v("To accomplish this, you'll need a properly hashed or encrypted\npassword to use in the config. Rundeck has a built in command line utility to\nencrypt passwords. The default encryption service is the Jetty password utility.")]),e._v(" "),a("p",[e._v('In this example,\nwe\'ll setup a new user named "jsmith", with a password of "mypass":')]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ java -jar rundeck-3.0.0.war --encryptpwd Jetty\nRequired values are marked with: *\nUsername "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Optional, but necessary "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" Crypt encoding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\njsmith    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("-----Type this value\n*Value To Encrypt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("The text you want to encrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\nmypass    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("-----Type this value\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("obfuscate: OBF:1xfd1zt11uha1ugg1zsp1xfp\nmd5: MD5:a029d0df84eb5549c641e04a9ef389e5\ncrypt: CRYPT:jsnDAc2Xk4W4o\n")])])]),a("p",[e._v("Then add this to the "),a("code",[e._v("realm.properties")]),e._v(" file with a line like so:")]),e._v(" "),a("pre",[a("code",[e._v("jsmith: MD5:a029d0df84eb5549c641e04a9ef389e5,user,admin\n")])]),e._v(" "),a("p",[e._v("Then restart Rundeck to ensure it picks up the change and you're done.")]),e._v(" "),a("p",[e._v('There is also a password encrypter utility user interface in the Rundeck application that\ncan be used to generate encrypted passwords. Click the gear icon and then "Password Utility" to use that interface.')]),e._v(" "),a("h4",{attrs:{id:"hot-reloading-the-realm-properties-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hot-reloading-the-realm-properties-file","aria-hidden":"true"}},[e._v("#")]),e._v(" Hot Reloading the "),a("code",[e._v("realm.properties")]),e._v(" file")]),e._v(" "),a("p",[e._v("If you want your changes to the "),a("code",[e._v("realm.properties")]),e._v(" file to be picked up without having to restart Rundeck change the module specified in the JAAS config file from "),a("code",[e._v("org.eclipse.jetty.jaas.spi.PropertyFileLoginModule")]),e._v(" to "),a("code",[e._v("org.rundeck.jaas.jetty.ReloadablePropertyFileLoginModule")])]),e._v(" "),a("p",[e._v("The refresh interval for checking the file is 5 seconds. This is not configurable.")]),e._v(" "),a("p",[e._v("For example, the following configuration uses the non-reloadable "),a("code",[e._v("realm.properties")])]),e._v(" "),a("pre",[a("code",[e._v('RDpropertyfilelogin {\n    org.eclipse.jetty.jaas.spi.PropertyFileLoginModule required\n    debug="true"\n    file="/etc/rundeck/server/config/realm.properties";\n};\n')])]),e._v(" "),a("p",[e._v("This configuration would enable hot reloading:")]),e._v(" "),a("pre",[a("code",[e._v('RDpropertyfilelogin {\n    org.rundeck.jaas.jetty.ReloadablePropertyFileLoginModule required\n    debug="true"\n    file="/etc/rundeck/server/config/realm.properties";\n};\n')])]),e._v(" "),a("h2",{attrs:{id:"ldap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ldap","aria-hidden":"true"}},[e._v("#")]),e._v(" LDAP")]),e._v(" "),a("p",[e._v("LDAP and Active Directory configurations are created in the same way, but your LDAP structure may be different than Active Directory's structure.")]),e._v(" "),a("p",[e._v("Rundeck includes two JAAS login modules you can use for LDAP directory authentication:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("JettyCachingLdapLoginModule")]),e._v(" Performs LDAP authentication and looks up user roles based on LDAP group membership")]),e._v(" "),a("li",[a("code",[e._v("JettyCombinedLdapLoginModule")]),e._v(' Performs LDAP authentication, and can use "shared authentication credentials" to allow another module to provide authorization lookup for user roles. See '),a("a",{attrs:{href:"#login-module-configuration"}},[e._v("Login module configuration")]),e._v(" and "),a("a",{attrs:{href:"#jettyrolepropertyfileloginmodule"}},[e._v("JettyRolePropertyFileLoginModule")]),e._v(" and "),a("a",{attrs:{href:"#multiple-authentication-modules"}},[e._v("Multiple Authentication Modules")]),e._v(" below.")])]),e._v(" "),a("p",[e._v("These are an enhanced version of the default Jetty JAAS Ldap login module that caches authorization results for a period of time.")]),e._v(" "),a("p",[e._v("JAAS supports evaluating "),a("code",[e._v("MD5")]),e._v(" and "),a("code",[e._v("CRYPT")]),e._v(" password hashes.")]),e._v(" "),a("p",[e._v("You must change some configuration values to change the authentication module to use.")]),e._v(" "),a("h3",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuration")]),e._v(" "),a("p",[e._v('Configuring LDAP consists of defining a JAAS config file (e.g. "jaas-ldap.conf"), and changing the server startup script to use this file and use the correct Login Module configuration inside it.')]),e._v(" "),a("h4",{attrs:{id:"sync-rundeck-profile-from-ldap-user-attributes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sync-rundeck-profile-from-ldap-user-attributes","aria-hidden":"true"}},[e._v("#")]),e._v(" Sync Rundeck profile from LDAP user attributes")]),e._v(" "),a("p",[e._v("You can use LDAP user attributes to update the email, first name, and last name properties of your Rundeck users.\nTo enable this feature, add the property: "),a("code",[e._v("rundeck.security.syncLdapUser=true")]),e._v(" to your "),a("code",[e._v("rundeck-config.properties")]),e._v(" file.")]),e._v(" "),a("p",[e._v("In your JAAS LDAP login module you can specify the ldap user attributes used to source the email, and name properties.\nThe properties are:")]),e._v(" "),a("pre",[a("code",[e._v('userLastNameAttribute="sn"\nuserFirstNameAttribute="givenName"\nuserEmailAttribute="mail"\n')])]),e._v(" "),a("p",[e._v("These LDAP attributes will be checked when a user logs in, and their Rundeck user profile will be updated from them.")]),e._v(" "),a("h4",{attrs:{id:"step-1-setup-the-ldap-login-module-configuration-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-1-setup-the-ldap-login-module-configuration-file","aria-hidden":"true"}},[e._v("#")]),e._v(" Step 1: Setup the LDAP login module configuration file")]),e._v(" "),a("p",[e._v("Create a "),a("code",[e._v("jaas-ldap.conf")]),e._v(" file in the same directory as the "),a("code",[e._v("jaas-loginmodule.conf")]),e._v(" file.")]),e._v(" "),a("ul",[a("li",[e._v("RPM/Deb install: "),a("code",[e._v("/etc/rundeck/")])]),e._v(" "),a("li",[e._v("Executable War install: "),a("code",[e._v("$RDECK_BASE/server/config")])])]),e._v(" "),a("p",[e._v('Make sure the name of your Login Module configuration is the same as you use in the next step. The Login Module configuration is defined like this (e.g. "jaas-ldap.conf" file):')]),e._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("    ldap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// comment line")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v('Where "ldap" is the module name.')]),e._v(" "),a("h4",{attrs:{id:"step-2-specify-login-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-2-specify-login-module","aria-hidden":"true"}},[e._v("#")]),e._v(" Step 2: Specify login module")]),e._v(" "),a("p",[e._v("To override the default JAAS configuration file, you will need to supply the Rundeck server with the proper path to the new one, and a "),a("code",[e._v("loginmodule.name")]),e._v(" Java system property to identify the new login module by name.")]),e._v(" "),a("p",[e._v("The JAAS configuration file location is specified differently between the Executable War and the RPM/Deb.")]),e._v(" "),a("p",[a("strong",[e._v("For the Executable War")]),e._v(": the "),a("code",[e._v("loginmodule.conf.name")]),e._v(" Java system property is used to identify the "),a("em",[e._v("name")]),e._v(" of the config file, which must be located in the "),a("code",[e._v("$RDECK_BASE/server/config")]),e._v(" dir.")]),e._v(" "),a("p",[e._v("You can simply specify the system properties on the java commandline:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("java -Drundeck.jaaslogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n     -Dloginmodule.conf.name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("jaas-ldap.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n     -Dloginmodule.name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("ldap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n     -jar rundeck-x.x.war\n")])])]),a("p",[e._v("Otherwise, if you are starting the Executable War via the supplied "),a("code",[e._v("rundeckd")]),e._v(" script, you can modify the "),a("code",[e._v("RDECK_JVM")]),e._v(" value in the "),a("code",[e._v("$RDECK_BASE/etc/profile")]),e._v(" file to add two JVM arguments:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RDECK_JVM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-Dloginmodule.conf.name=jaas-ldap.conf \\\n    -Drundeck.jaaslogin=true \\\n    -Dloginmodule.name=ldap"')]),e._v("\n")])])]),a("p",[e._v("Note: more information about using the Executable War and useful properties are under [Getting Started - Executable War Options](/administration/install/jar.md#launcher-options].")]),e._v(" "),a("p",[a("strong",[e._v("For the RPM/Deb installation")]),e._v(": the absolute path to the JAAS config file must be specified with the "),a("code",[e._v("java.security.auth.login.config")]),e._v(" property.")]),e._v(" "),a("p",[e._v("Declare "),a("code",[e._v("RDECK_JVM_OPTS")]),e._v(" in "),a("code",[e._v("/etc/sysconfig/rundeckd")]),e._v(" (rpm) or "),a("code",[e._v("/etc/default/rundeckd")]),e._v(" (deb):")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RDECK_JVM_OPTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-Drundeck.jaaslogin=true \\\n       -Djava.security.auth.login.config=/etc/rundeck/jaas-ldap.conf \\\n       -Dloginmodule.name=ldap"')]),e._v("\n")])])]),a("h4",{attrs:{id:"step-3-restart-rundeckd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-3-restart-rundeckd","aria-hidden":"true"}},[e._v("#")]),e._v(" Step 3: Restart rundeckd")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" /etc/init.d/rundeckd restart\n")])])]),a("h4",{attrs:{id:"step-4-attempt-to-logon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-4-attempt-to-logon","aria-hidden":"true"}},[e._v("#")]),e._v(" Step 4: Attempt to logon")]),e._v(" "),a("p",[e._v("If everything was configured correctly, you will be able to access Rundeck using your AD credentials. If something did not go smoothly, look at "),a("code",[e._v("/var/log/rundeck/service.log")]),e._v(" for stack traces that may indicate what is wrong.\nTo make troubleshooting easier, you may want to add the "),a("code",[e._v("-Dcom.dtolabs.rundeck.jetty.jaas.LEVEL=DEBUG")]),e._v(" Java system property to the "),a("code",[e._v("RDECK_JVM")]),e._v(" environment variable above, to have enable DEBUG logging for the authentication module.")]),e._v(" "),a("h3",{attrs:{id:"login-module-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#login-module-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" Login module configuration")]),e._v(" "),a("p",[e._v("Here is an example configuration file for the "),a("code",[e._v("JettyCachingLdapLoginModule")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-c .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("ldap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("dtolabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyCachingLdapLoginModule required\n      debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n      contextFactory"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"com.sun.jndi.ldap.LdapCtxFactory"')]),e._v("\n      providerUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ldap://server:389"')]),e._v("\n      bindDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn=Manager,dc=example,dc=com"')]),e._v("\n      bindPassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"secrent"')]),e._v("\n      authenticationMethod"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"simple"')]),e._v("\n      forceBindingLogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),e._v("\n      userBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=People,dc=test1,dc=example,dc=com"')]),e._v("\n      userRdnAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"uid"')]),e._v("\n      userIdAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"uid"')]),e._v("\n      userPasswordAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"userPassword"')]),e._v("\n      userObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"account"')]),e._v("\n      userLastNameAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sn"')]),e._v("\n      userFirstNameAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"givenName"')]),e._v("\n      userEmailAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mail"')]),e._v("\n      roleBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=Groups,dc=test1,dc=example,dc=com"')]),e._v("\n      roleNameAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn"')]),e._v("\n      roleUsernameMemberAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"memberUid"')]),e._v("\n      roleMemberAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"memberUid"')]),e._v("\n      roleObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"posixGroup"')]),e._v("\n      cacheDurationMillis"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"300000"')]),e._v("\n      supplementalRoles"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"user"')]),e._v("\n      reportStatistics"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n      timeoutRead"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10000"')]),e._v("\n      timeoutConnect"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"20000"')]),e._v("\n      nestedGroups"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The "),a("code",[e._v("JettyCachingLdapLoginModule")]),e._v(" has these configuration properties:")]),e._v(" "),a("dl",[a("dt",[a("code",[e._v("debug")])]),e._v(" "),a("dd",[e._v('"true/false" - turn on or off debug output')]),e._v(" "),a("dt",[a("code",[e._v("contextFactory")])]),e._v(" "),a("dd",[e._v('The LDAP context factory class, e.g. "com.sun.jndi.ldap.LdapCtxFactory"')]),e._v(" "),a("dt",[a("code",[e._v("providerUrl")])]),e._v(" "),a("dd",[e._v('ldap URL for the server, e.g. "ldap://server:389"')]),e._v(" "),a("dt",[a("code",[e._v("bindDn")])]),e._v(" "),a("dd",[e._v('Optional. If not using "binding" authentication, set this to the root DN that should bind, e.g. "cn=Manager,dc=example,dc=com"')]),e._v(" "),a("dt",[a("code",[e._v("bindPassword")])]),e._v(" "),a("dd",[e._v("password for root DN. "),a("strong",[e._v("Note")]),e._v(": The "),a("code",[e._v("bindDn")]),e._v(" and "),a("code",[e._v("bindPassword")]),e._v(" must escape any special characters with "),a("code",[e._v("\\")]),e._v(" character. Special characters include "),a("code",[e._v("\\")]),e._v(" (backslash), as well as "),a("code",[e._v("!")]),e._v(" (exclamation).")]),e._v(" "),a("dt",[a("code",[e._v("authenticationMethod")])]),e._v(" "),a("dd",[e._v('Authentication method, e.g. "simple"')]),e._v(" "),a("dt",[a("code",[e._v("forceBindingLogin")])]),e._v(" "),a("dd",[e._v('"true/false" - if true, bind as the user that is authenticating, otherwise bind as the manager and perform a search to verify user password. NOTE: This module can only verify passwords hashed with '),a("code",[e._v("MD5")]),e._v(" or "),a("code",[e._v("CRYPT")]),e._v(". If your LDAP directory contains other hashes you'll likely need to set this to true to be able to authenticate.")]),e._v(" "),a("dt",[a("code",[e._v("forceBindingLoginUseRootContextForRoles")])]),e._v(" "),a("dd",[e._v('"true/false" - if true and forceBindingLogin is true, then role membership searches will be performed in the root context, rather than in the bound user context.')]),e._v(" "),a("dt",[a("code",[e._v("userBaseDn")])]),e._v(" "),a("dd",[e._v('base DN to search for users, example: "ou=People,dc=test1,dc=example,dc=com"')]),e._v(" "),a("dt",[a("code",[e._v("userRdnAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for username, used when searching for user role membership by DN, default "uid".')]),e._v(" "),a("dt",[a("code",[e._v("userIdAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name to identify user by username, default "cn".')]),e._v(" "),a("dt",[a("code",[e._v("userPasswordAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for user password, default "userPassword".')]),e._v(" "),a("dt",[a("code",[e._v("userObjectClass")])]),e._v(" "),a("dd",[e._v('Attribute name for user object class, default "inetOrgPerson".')]),e._v(" "),a("dt",[a("code",[e._v("userLastNameAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for user\'s last name, default "sn".')]),e._v(" "),a("dt",[a("code",[e._v("userFirstNameAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for user\'s first name, default "givenName".')]),e._v(" "),a("dt",[a("code",[e._v("userEmailAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for user\'s email address, default "mail".')]),e._v(" "),a("dt",[a("code",[e._v("roleBaseDn")])]),e._v(" "),a("dd",[e._v('Base DN for role membership search, e.g. "ou=Groups,dc=test1,dc=example,dc=com".')]),e._v(" "),a("dt",[a("code",[e._v("roleNameAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for role name, default "roleName".')]),e._v(" "),a("dt",[a("code",[e._v("roleMemberAttribute")])]),e._v(" "),a("dd",[e._v('Attribute name for a role that would contain a user\'s DN, default "uniqueMember".')]),e._v(" "),a("dt",[a("code",[e._v("roleUsernameMemberAttribute")])]),e._v(" "),a("dd",[e._v("Attribute name for a role that would contain a user's username. If set, this overrides the "),a("code",[e._v("roleMemberAttribute")]),e._v(" behavior.")]),e._v(" "),a("dt",[a("code",[e._v("roleObjectClass")])]),e._v(" "),a("dd",[e._v('Object class for role, default "groupOfUniqueNames".')]),e._v(" "),a("dt",[a("code",[e._v("rolePrefix")])]),e._v(" "),a("dd",[e._v('Prefix string to remove from role names before returning to the application, e.g. "rundeck_".')]),e._v(" "),a("dt",[a("code",[e._v("cacheDurationMillis")])]),e._v(" "),a("dd",[e._v('Duration that authorization should be cached, in milliseconds. Default "0". A value of "0" indicates no caching should be used.')]),e._v(" "),a("dt",[a("code",[e._v("reportStatistics")])]),e._v(" "),a("dd",[e._v('"true/false" - if true, output cache statistics to the log.')]),e._v(" "),a("dt",[a("code",[e._v("supplementalRoles")])]),e._v(" "),a("dd",[e._v('Comma-separated list of role names. All of the given role names will be automatically added to authenticated users. You can use this to provide a "default" role or roles for all users.')]),e._v(" "),a("dt",[a("code",[e._v("timeoutRead")])]),e._v(" "),a("dd",[e._v("Read timeout value (ms). Default: 0 (no timeout)")]),e._v(" "),a("dt",[a("code",[e._v("timeoutConnect")])]),e._v(" "),a("dd",[e._v("Connect timeout value (ms). Default: 0 (no timeout)")]),e._v(" "),a("dt",[a("code",[e._v("nestedGroups")])]),e._v(" "),a("dd",[e._v('"true/false" - Default: false. If true, will resolve all nested groups for authenticated users. For the first user to login after a fresh start it will take a couple of seconds longer, this is when the cache of all nested groups is built. This will happen as often as the cache is refreshed. Uses the cacheDurationMillis for cache timeout.')])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("JettyCombinedLdapLoginModule")]),e._v(" is extends the previous module, so is configured in almost exactly the same way, but adds these additional configuration options:")]),e._v(" "),a("div",{staticClass:"language-c .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("ldap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("dtolabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyCombinedLdapLoginModule required\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n      ignoreRoles"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n      storePass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n      clearPass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n      useFirstPass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),e._v("\n      tryFirstPass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("dl",[a("dt",[a("code",[e._v("ignoreRoles")])]),e._v(" "),a("dd",[e._v("Do not look up role membership via LDAP. May be used with "),a("code",[e._v("storePass")]),e._v(" and combined with another login module for authorization roles. (See "),a("a",{attrs:{href:"#jettyrolepropertyfileloginmodule"}},[e._v("JettyRolePropertyFileLoginModule")]),e._v(")")]),e._v(" "),a("dt",[a("code",[e._v("storePass")])]),e._v(" "),a("dd",[e._v("Store the user/password for use by subsequent login module.")]),e._v(" "),a("dt",[a("code",[e._v("clearPass")])]),e._v(" "),a("dd",[e._v("Clear the user/password that was stored after login is successful. (This would prevent any subsequent login modules from re-using the stored credentials. Set it to "),a("code",[e._v("false")]),e._v(" if you want to continue using the credentials.)")]),e._v(" "),a("dt",[a("code",[e._v("useFirstPass")])]),e._v(" "),a("dd",[e._v("Use the stored user/password for authentication, and do not attempt to use other mechanism (e.g. login callback).")]),e._v(" "),a("dt",[a("code",[e._v("tryFirstPass")])]),e._v(" "),a("dd",[e._v("Try to use the stored user/password for authentication, if it fails then proceed with normal mechanism.")])]),e._v(" "),a("h3",{attrs:{id:"combining-ldap-with-other-modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#combining-ldap-with-other-modules","aria-hidden":"true"}},[e._v("#")]),e._v(" Combining LDAP with other modules")]),e._v(" "),a("p",[e._v("Use the "),a("code",[e._v("JettyCombinedLdapLoginModule")]),e._v(" to do LDAP authentication, then combine it with the "),a("a",{attrs:{href:"#jettyrolepropertyfileloginmodule"}},[e._v("JettyRolePropertyFileLoginModule")]),e._v(" (or some other module) to supply the authorization roles.")]),e._v(" "),a("p",[e._v("The first module should set "),a("code",[e._v('storePass="true"')]),e._v(", and the second module should set "),a("code",[e._v('useFirstPass="true"')]),e._v(" or "),a("code",[e._v('tryFirstPass="true"')]),e._v(".")]),e._v(" "),a("p",[e._v("Finally, see the section "),a("a",{attrs:{href:"#multiple-authentication-modules"}},[e._v("Multiple Authentication Modules")]),e._v(" about the appropriate configuration Flag to use.")]),e._v(" "),a("p",[e._v("The "),a("a",{attrs:{href:"#pam"}},[e._v("PAM")]),e._v(" section is a useful comparison as it uses the same method to combine modules.")]),e._v(" "),a("h3",{attrs:{id:"active-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#active-directory","aria-hidden":"true"}},[e._v("#")]),e._v(" Active Directory")]),e._v(" "),a("p",[e._v("Here is an example configuration for Active Directory. The string "),a("em",[e._v("sAMAccountName")]),e._v(" refers to the short user name and is valid in a default Active Directory installation, but may vary in some environments.")]),e._v(" "),a("div",{staticClass:"language-c .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("activedirectory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("dtolabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyCachingLdapLoginModule required\n    debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n    contextFactory"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"com.sun.jndi.ldap.LdapCtxFactory"')]),e._v("\n    providerUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ldap://localhost:389"')]),e._v("\n    bindDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn=Manager,dc=rundeck,dc=com"')]),e._v("\n    bindPassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"secret"')]),e._v("\n    authenticationMethod"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"simple"')]),e._v("\n    forceBindingLogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n    userBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=users,dc=rundeck,dc=com"')]),e._v("\n    userRdnAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sAMAccountName"')]),e._v("\n    userIdAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sAMAccountName"')]),e._v("\n    userPasswordAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"unicodePwd"')]),e._v("\n    userObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"user"')]),e._v("\n    roleBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=roles,dc=rundeck,dc=com"')]),e._v("\n    roleNameAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn"')]),e._v("\n    roleMemberAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"member"')]),e._v("\n    roleObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"group"')]),e._v("\n    cacheDurationMillis"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"300000"')]),e._v("\n    reportStatistics"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"communicating-over-secure-ldap-ldaps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#communicating-over-secure-ldap-ldaps","aria-hidden":"true"}},[e._v("#")]),e._v(" Communicating over secure ldap (ldaps://)")]),e._v(" "),a("p",[e._v("The default port for communicating with active directory is 389, which is insecure. The secure port is 636, but the LoginModule describe above requires that the AD certificate or organizations CA certificate be placed in a truststore. The truststore provided with rundeck "),a("code",[e._v("/etc/rundeck/ssl/truststore")]),e._v(" is used for the local communication between the cli tools and the rundeck server.")]),e._v(" "),a("p",[e._v("Before you can establish trust, you need to get the CA certificate. Typically, this would require a request to the organization's security officer to have them send you the certificate. It's also often found publicly if your organization does secure transactions.")]),e._v(" "),a("p",[e._v("Another option is to interrogate the secure ldap endpoint with openssl. The example below shows a connection to paypal.com on port 443. The first certificate is the machine and that last is the CA. Pick the last certificate.")]),e._v(" "),a("p",[a("em",[e._v("note")]),e._v(" that for Active Directory, the host would be the Active Directory server and port 636.\n"),a("em",[e._v("note")]),e._v(" Certificates are PEM encoded and start with -----BEGIN CERTIFICATE----- end with -----END CERTIFICATE----- inclusive.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ openssl s_client -showcerts -connect paypal.com:443\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('CONNECTED(00000003)\ndepth=1 C = US, O = "VeriSign, Inc.", OU = VeriSign Trust Network, OU = Terms of use at https://www.verisign.com/rpa (c)09, CN = VeriSign Class 3 Secure Server CA - G2\nverify error:num=20:unable to get local issuer certificate\nverify return:0\n---\nCertificate chain\n 0 s:/C=US/ST=California/L=San Jose/O=PayPal, Inc./OU=Information Systems/CN=paypal.com\n   i:/C=US/O=VeriSign, Inc./OU=VeriSign Trust Network/OU=Terms of use at https://www.verisign.com/rpa (c)09/CN=VeriSign Class 3 Secure Server CA - G2\n-----BEGIN CERTIFICATE-----\nMIIFDjCCA/agAwIBAgIQL0NdM6l74HplIwrcygDcCTANBgkqhkiG9w0BAQUFADCB\ntTELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQL\nExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrMTswOQYDVQQLEzJUZXJtcyBvZiB1c2Ug\nYXQgaHR0cHM6Ly93d3cudmVyaXNpZ24uY29tL3JwYSAoYykwOTEvMC0GA1UEAxMm\nVmVyaVNpZ24gQ2xhc3MgMyBTZWN1cmUgU2VydmVyIENBIC0gRzIwHhcNMTAwNTAz\nMDAwMDAwWhcNMTIwNjExMjM1OTU5WjB/MQswCQYDVQQGEwJVUzETMBEGA1UECBMK\nQ2FsaWZvcm5pYTERMA8GA1UEBxQIU2FuIEpvc2UxFTATBgNVBAoUDFBheVBhbCwg\nSW5jLjEcMBoGA1UECxQTSW5mb3JtYXRpb24gU3lzdGVtczETMBEGA1UEAxQKcGF5\ncGFsLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEArlvu+86iVb4RXdX+\n8MjmGynNSl+Hu2/ZJ7nU1sj5O2jASWwFH7PFUv10qlRtL+gi3Rjw+zFN958iUetz\nef4CxQYf52PA7Uj9YlFEzLz7f8UDotu4WNLM3QGbLrqS28pPb2qKyyOQDvwNpI1c\nJt4JDa0ofVnCdICZEnf+cJB121MCAwEAAaOCAdEwggHNMAkGA1UdEwQCMAAwCwYD\nVR0PBAQDAgWgMEUGA1UdHwQ+MDwwOqA4oDaGNGh0dHA6Ly9TVlJTZWN1cmUtRzIt\nY3JsLnZlcmlzaWduLmNvbS9TVlJTZWN1cmVHMi5jcmwwRAYDVR0gBD0wOzA5Bgtg\nhkgBhvhFAQcXAzAqMCgGCCsGAQUFBwIBFhxodHRwczovL3d3dy52ZXJpc2lnbi5j\nb20vcnBhMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAfBgNVHSMEGDAW\ngBSl7wsRzsBBA6NKZZBIshzgVy19RzB2BggrBgEFBQcBAQRqMGgwJAYIKwYBBQUH\nMAGGGGh0dHA6Ly9vY3NwLnZlcmlzaWduLmNvbTBABggrBgEFBQcwAoY0aHR0cDov\nL1NWUlNlY3VyZS1HMi1haWEudmVyaXNpZ24uY29tL1NWUlNlY3VyZUcyLmNlcjBu\nBggrBgEFBQcBDARiMGChXqBcMFowWDBWFglpbWFnZS9naWYwITAfMAcGBSsOAwIa\nBBRLa7kolgYMu9BSOJsprEsHiyEFGDAmFiRodHRwOi8vbG9nby52ZXJpc2lnbi5j\nb20vdnNsb2dvMS5naWYwDQYJKoZIhvcNAQEFBQADggEBADbOGDkzZy22y+fW4OR7\nwkx+1E3BxnRMZYx89OOykzTEUt2UV5DVuccUbqxTxg9/4pKMYJLywYn9UIOPHpwx\nfbvMQNpdqV3JSuGMTwpROrMvC3bT13aCxxDnozeCjd/lH74m6G5ef2EUd3m5Y+iC\nfMPo2NMrVyQYOCtpJurh9Tre1gQFHUYAXw8ty0YxfMoR/7FwYbd4spiZJwL2Mvfn\n9gn24dWuKY7JaFutomwOM78rGzBDZZ/spEx9rcNa3OuVHcqBamnnXQZlZJilj4LE\nbuMBx8ti5Oqy4z1u1vzA8HalseiZerqFtBGOIakXdto8qLnwYEHQvVa/ih5iTsi3\nJa8=\n-----END CERTIFICATE-----\n 1 s:/C=US/O=VeriSign, Inc./OU=VeriSign Trust Network/OU=Terms of use at https://www.verisign.com/rpa (c)09/CN=VeriSign Class 3 Secure Server CA - G2\n   i:/C=US/O=VeriSign, Inc./OU=Class 3 Public Primary Certification Authority - G2/OU=(c) 1998 VeriSign, Inc. - For authorized use only/OU=VeriSign Trust Network\n-----BEGIN CERTIFICATE-----\nMIIGLDCCBZWgAwIBAgIQbk/6s8XmacTRZ8mSq+hYxDANBgkqhkiG9w0BAQUFADCB\nwTELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMTwwOgYDVQQL\nEzNDbGFzcyAzIFB1YmxpYyBQcmltYXJ5IENlcnRpZmljYXRpb24gQXV0aG9yaXR5\nIC0gRzIxOjA4BgNVBAsTMShjKSAxOTk4IFZlcmlTaWduLCBJbmMuIC0gRm9yIGF1\ndGhvcml6ZWQgdXNlIG9ubHkxHzAdBgNVBAsTFlZlcmlTaWduIFRydXN0IE5ldHdv\ncmswHhcNMDkwMzI1MDAwMDAwWhcNMTkwMzI0MjM1OTU5WjCBtTELMAkGA1UEBhMC\nVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQLExZWZXJpU2lnbiBU\ncnVzdCBOZXR3b3JrMTswOQYDVQQLEzJUZXJtcyBvZiB1c2UgYXQgaHR0cHM6Ly93\nd3cudmVyaXNpZ24uY29tL3JwYSAoYykwOTEvMC0GA1UEAxMmVmVyaVNpZ24gQ2xh\nc3MgMyBTZWN1cmUgU2VydmVyIENBIC0gRzIwggEiMA0GCSqGSIb3DQEBAQUAA4IB\nDwAwggEKAoIBAQDUVo9XOzcopkBj0pXVBXTatRlqltZxVy/iwDSMoJWzjOE3JPMu\n7UNFBY6J1/raSrX4Po1Ox/lJUEU3QJ90qqBRVWHxYISJpZ6AjS+wIapFgsTPtBR/\nRxUgKIKwaBLArlwH1/ZZzMtiVlxNSf8miKtUUTovStoOmOKJcrn892g8xB85essX\ngfMMrQ/cYWIbEAsEHikYcV5iy0PevjG6cQIZTiapUdqMZGkD3pz9ff17Ybz8hHyI\nXLTDe+1fK0YS8f0AAZqLW+mjBS6PLlve8xt4+GaRCMBeztWwNsrUqHugffkwer/4\n3RlRKyC6/qfPoU6wZ/WAqiuDLtKOVImOHikLAgMBAAGjggKpMIICpTA0BggrBgEF\nBQcBAQQoMCYwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLnZlcmlzaWduLmNvbTAS\nBgNVHRMBAf8ECDAGAQH/AgEAMHAGA1UdIARpMGcwZQYLYIZIAYb4RQEHFwMwVjAo\nBggrBgEFBQcCARYcaHR0cHM6Ly93d3cudmVyaXNpZ24uY29tL2NwczAqBggrBgEF\nBQcCAjAeGhxodHRwczovL3d3dy52ZXJpc2lnbi5jb20vcnBhMDQGA1UdHwQtMCsw\nKaAnoCWGI2h0dHA6Ly9jcmwudmVyaXNpZ24uY29tL3BjYTMtZzIuY3JsMA4GA1Ud\nDwEB/wQEAwIBBjBtBggrBgEFBQcBDARhMF+hXaBbMFkwVzBVFglpbWFnZS9naWYw\nITAfMAcGBSsOAwIaBBSP5dMahqyNjmvDz4Bq1EgYLHsZLjAlFiNodHRwOi8vbG9n\nby52ZXJpc2lnbi5jb20vdnNsb2dvLmdpZjApBgNVHREEIjAgpB4wHDEaMBgGA1UE\nAxMRQ2xhc3MzQ0EyMDQ4LTEtNTIwHQYDVR0OBBYEFKXvCxHOwEEDo0plkEiyHOBX\nLX1HMIHnBgNVHSMEgd8wgdyhgcekgcQwgcExCzAJBgNVBAYTAlVTMRcwFQYDVQQK\nEw5WZXJpU2lnbiwgSW5jLjE8MDoGA1UECxMzQ2xhc3MgMyBQdWJsaWMgUHJpbWFy\neSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eSAtIEcyMTowOAYDVQQLEzEoYykgMTk5\nOCBWZXJpU2lnbiwgSW5jLiAtIEZvciBhdXRob3JpemVkIHVzZSBvbmx5MR8wHQYD\nVQQLExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrghB92f4Hz6getxB5Z/uniTTGMA0G\nCSqGSIb3DQEBBQUAA4GBAGN0Lz1Tqi+X7CYRZhr+8d5BJxnSf9jBHPniOFY6H5Cu\nOcUgdav4bC1nHynCIdcUiGNLsJsnY5H48KMBJLb7j+M9AgtvVP7UzNvWhb98lR5e\nYhHB2QmcQrmy1KotmDojYMyimvFu6M+O0Ro8XhnF15s1sAIjJOUFuNWI4+D6ufRf\n-----END CERTIFICATE-----\n---\nServer certificate\nsubject=/C=US/ST=California/L=San Jose/O=PayPal, Inc./OU=Information Systems/CN=paypal.com\nissuer=/C=US/O=VeriSign, Inc./OU=VeriSign Trust Network/OU=Terms of use at https://www.verisign.com/rpa (c)09/CN=VeriSign Class 3 Secure Server CA - G2\n---\nNo client certificate CA names sent\n---\nSSL handshake has read 3039 bytes and written 401 bytes\n---\nNew, TLSv1/SSLv3, Cipher is DES-CBC3-SHA\nServer public key is 1024 bit\nSecure Renegotiation IS NOT supported\nCompression: NONE\nExpansion: NONE\nSSL-Session:\n    Protocol  : TLSv1\n    Cipher    : DES-CBC3-SHA\n    Session-ID: A8AAA4F22E9A4B3F12F76303464643525178846D96CA0BC0B81F35368BF55B89\n    Session-ID-ctx:\n    Master-Key: 9F767B91FC2450E291CBB21E3438CA9A73FE8D5B825AD98F821F5EB912C088DFB66FCBF2D53591E2D1ED77E9B6A22504\n    Key-Arg   : None\n    PSK identity: None\n    PSK identity hint: None\n    Start Time: 1295242116\n    Timeout   : 300 (sec)\n    Verify return code: 20 (unable to get local issuer certificate)\n---\n^C\n')])])]),a("p",[e._v("Once a certificate has been obtained. There are two options for adding the certificate. The first involves updating the truststore for the JRE. If that is not possible or not desirable, then one can set the truststore to be used by the jvm, using any arbitrary truststore that contains the appropriate certificate.")]),e._v(" "),a("p",[e._v("Both options require importing a certificate. The following would import a certificate called, AD.cert into the "),a("code",[e._v("/etc/rundeck/ssl/truststore")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("keytool -import -alias CompanyAD -file AD.cert -keystore  /etc/rundeck/ssl/truststore -storepass adminadmin\n")])])]),a("p",[e._v("To add the certificate to the JRE, locate the file $JAVA_HOME/lib/security/cacerts and run")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("keytool -import -alias CompanyAD -file AD.cert -keystore "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$JAVA_HOME")]),e._v("/lib/security/cacerts -storepass changeit\n")])])]),a("p",[e._v("To verify your CA has been added, run keytool list and look for CompanyAD in the output.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("keytool -list -keystore "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$JAVA_HOME")]),e._v("/lib/security/cacerts -storepass changeit\n")])])]),a("p",[e._v("Refer to: https://docs.oracle.com/javase/1.5.0/docs/tooldocs/solaris/keytool.html for more information how how to import a certificate.")]),e._v(" "),a("p",[e._v("Finally, in your "),a("code",[e._v("ldap-activedirectory.conf")]),e._v(" be sure to change the "),a("em",[e._v("providerUrl")]),e._v(" to be "),a("code",[e._v("ldaps://ad-server")]),e._v(". Including the port is optional as the default is 686.")]),e._v(" "),a("h2",{attrs:{id:"pam"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pam","aria-hidden":"true"}},[e._v("#")]),e._v(" PAM")]),e._v(" "),a("p",[e._v("Rundeck includes a "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Pluggable_authentication_module",target:"_blank",rel:"noopener noreferrer"}},[e._v("PAM"),a("OutboundLink")],1),e._v(" JAAS login module, which uses "),a("a",{attrs:{href:"https://github.com/kohsuke/libpam4j",target:"_blank",rel:"noopener noreferrer"}},[e._v("libpam4j"),a("OutboundLink")],1),e._v(" to authenticate.")]),e._v(" "),a("p",[e._v("In order for Rundeck to have the necessary permissions to check user credentials, the user that runs the Rundeck process must be in the "),a("code",[e._v("shadow")]),e._v(" group.\nThis can be done with the command:")]),e._v(" "),a("pre",[a("code",[e._v("$ sudo addgroup rundeck shadow\n")])]),e._v(" "),a("p",[e._v("On debian based systems you need to install libpam4j :")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" libpam4j-java\n")])])]),a("p",[e._v("This module can work with existing properties-file based authorization roles by enabling shared credentials between the modules, and introducing a Property file module that can be used only for authorization.")]),e._v(" "),a("p",[e._v("Modules:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("org.rundeck.jaas.jetty.JettyPamLoginModule")]),e._v(" authenticates via PAM, can add a default set of roles to authenticated users, and can use local unix group membership for role info.")]),e._v(" "),a("li",[a("code",[e._v("org.rundeck.jaas.jetty.JettyAuthPropertyFileLoginModule")]),e._v(" authenticates via property file, but does not supply user authorization information.")]),e._v(" "),a("li",[a("code",[e._v("org.rundeck.jaas.jetty.JettyRolePropertyFileLoginModule")]),e._v(" does not authenticate and only uses authorization roles from a property file. Can be combined with previous modules.")])]),e._v(" "),a("p",[e._v("sample jaas config:")]),e._v(" "),a("div",{staticClass:"language-c .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("RDpropertyfilelogin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyPamLoginModule requisite\n        debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n        service"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sshd"')]),e._v("\n        supplementalRoles"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"readonly"')]),e._v("\n        storePass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyRolePropertyFileLoginModule required\n        debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n        useFirstPass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n        file"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/etc/rundeck/realm.properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("When combining the two login modules, note that the "),a("code",[e._v("storePass")]),e._v(" and\n"),a("code",[e._v("useFirstPass")]),e._v(" are set to true, allowing the two modules to share the user information necessary for the second module to load the user roles.")]),e._v(" "),a("p",[a("strong",[e._v("Common configuration properties:")])]),e._v(" "),a("p",[e._v("These JAAS configuration properties are used by all of the Jetty PAM modules:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("useFirstPass")])]),e._v(" "),a("li",[a("code",[e._v("tryFirstPass")])]),e._v(" "),a("li",[a("code",[e._v("storePass")])]),e._v(" "),a("li",[a("code",[e._v("clearPass")])]),e._v(" "),a("li",[a("code",[e._v("debug")])])]),e._v(" "),a("h3",{attrs:{id:"jettypamloginmodule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jettypamloginmodule","aria-hidden":"true"}},[e._v("#")]),e._v(" JettyPamLoginModule")]),e._v(" "),a("p",[e._v("Configuration properties:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("serviceName")]),e._v(' - name of the PAM service configuration to use. (Required). Example: "sshd".')]),e._v(" "),a("li",[a("code",[e._v("useUnixGroups")]),e._v(" - true/false. If true, the unix Groups defined for the user will be included as authorization roles. Default: false.")]),e._v(" "),a("li",[a("code",[e._v("supplementalRoles")]),e._v(" - a comma-separated list of additional user roles to add to any authenticated user. Example: 'user,readonly'")])]),e._v(" "),a("h2",{attrs:{id:"jettyrolepropertyfileloginmodule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jettyrolepropertyfileloginmodule","aria-hidden":"true"}},[e._v("#")]),e._v(" JettyRolePropertyFileLoginModule")]),e._v(" "),a("p",[e._v("This module does not authenticate, and requires that "),a("code",[e._v("useFirstPass")]),e._v(" or "),a("code",[e._v("tryFirstPass")]),e._v(" is set to "),a("code",[e._v("true")]),e._v(", and that a previous module has "),a("code",[e._v("storePass")]),e._v(" set to "),a("code",[e._v("true")]),e._v(".")]),e._v(" "),a("p",[e._v("It then looks the username up in the Properties file, and applies any roles for the matching user, if found.")]),e._v(" "),a("p",[e._v("Configuration properties:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("file")]),e._v(" - path to a Java Property formatted file in the format defined under "),a("a",{attrs:{href:"#PropertyFileLoginModule"}},[e._v("realm.properties")])]),e._v(" "),a("li",[a("code",[e._v("caseInsensitive")]),e._v(" - true/false. If true, usernames are converted to lowercase before being looked up in the property file, otherwise they are compared as entered. Default: true.")])]),e._v(" "),a("p",[e._v("Note that since the user password is not used for authentication, you can have a dummy value in the password field of the file, but "),a("em",[e._v("some value is required")]),e._v(" in that position.")]),e._v(" "),a("p",[e._v("Example properties file with dummy passwords and roles:")]),e._v(" "),a("pre",[a("code",[e._v("admin: -,user,admin\nuser1: -,user,readonly\n")])]),e._v(" "),a("h2",{attrs:{id:"jettyauthpropertyfileloginmodule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jettyauthpropertyfileloginmodule","aria-hidden":"true"}},[e._v("#")]),e._v(" JettyAuthPropertyFileLoginModule")]),e._v(" "),a("p",[e._v("This module provides authentication in the same way as the "),a("a",{attrs:{href:"#PropertyFileLoginModule"}},[e._v("realm.properties")]),e._v(" mechanism, but does not use any of the role names found in the file. It can be combined with "),a("code",[e._v("JettyRolePropertyFileLoginModule")]),e._v(" by using "),a("code",[e._v("storePass=true")]),e._v(".")]),e._v(" "),a("p",[e._v("Configuration properties:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("hotReload")]),e._v(" - "),a("code",[e._v('hotReload="true"')]),e._v(" enables the ability to modify the user list specified by "),a("code",[e._v("file")]),e._v(" without having to restart Rundeck. The refresh interval for checking the file is 5 seconds. This is not configurable.")]),e._v(" "),a("li",[a("code",[e._v("file")]),e._v(" - path to a Java Property formatted file in the format defined under "),a("a",{attrs:{href:"#realm.properties"}},[e._v("realm.properties")])])]),e._v(" "),a("h2",{attrs:{id:"multiple-authentication-modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multiple-authentication-modules","aria-hidden":"true"}},[e._v("#")]),e._v(" Multiple Authentication Modules")]),e._v(" "),a("p",[e._v("JAAS configurations can contain multiple LoginModule definitions, which are processed in order and according to the logic of the configuration Flag.")]),e._v(" "),a("p",[e._v("In your config file, separate the LoginModule definitions with a "),a("code",[e._v(";")]),e._v(" and be sure to select the appropriate Flag for the module, one of "),a("code",[e._v("required")]),e._v(", "),a("code",[e._v("requisite")]),e._v(", "),a("code",[e._v("sufficient")]),e._v(", or "),a("code",[e._v("optional")]),e._v(".")]),e._v(" "),a("p",[e._v("The full syntax and the description of how these Flags work is described in more detail under the "),a("a",{attrs:{href:"https://docs.oracle.com/javase/6/docs/api/javax/security/auth/login/Configuration.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JAAS Configuration Documentation"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Here is an example combining an LDAP module flagged as "),a("code",[e._v("sufficient")]),e._v(", and a flat file realm.properties config flagged as "),a("code",[e._v("required")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-c .numberLines extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("multiauth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\n  com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("dtolabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("rundeck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("JettyCachingLdapLoginModule sufficient\n    debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n    contextFactory"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"com.sun.jndi.ldap.LdapCtxFactory"')]),e._v("\n    providerUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ldap://server:389"')]),e._v("\n    bindDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn=Manager,dc=example,dc=com"')]),e._v("\n    bindPassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"secrent"')]),e._v("\n    authenticationMethod"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"simple"')]),e._v("\n    forceBindingLogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"false"')]),e._v("\n    userBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=People,dc=test1,dc=example,dc=com"')]),e._v("\n    userRdnAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"uid"')]),e._v("\n    userIdAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"uid"')]),e._v("\n    userPasswordAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"userPassword"')]),e._v("\n    userObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"account"')]),e._v("\n    roleBaseDn"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ou=Groups,dc=test1,dc=example,dc=com"')]),e._v("\n    roleNameAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cn"')]),e._v("\n    roleUsernameMemberAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"memberUid"')]),e._v("\n    roleMemberAttribute"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"memberUid"')]),e._v("\n    roleObjectClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"posixGroup"')]),e._v("\n    cacheDurationMillis"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"300000"')]),e._v("\n    reportStatistics"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("eclipse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jetty"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("jaas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("spi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("PropertyFileLoginModule required\n    debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"true"')]),e._v("\n    file"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/etc/rundeck/realm.properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Based on the flags, JAAS would attempt the following for authentication:")]),e._v(" "),a("ol",[a("li",[e._v("Check username/pass against LDAP")]),e._v(" "),a("li",[e._v("If auth succeeds, finish with successful authentication")]),e._v(" "),a("li",[e._v("If auth fails, continue to the next module")]),e._v(" "),a("li",[e._v("Check username/pass against the properties file")]),e._v(" "),a("li",[e._v("If auth succeeds, finish with successful authentication")]),e._v(" "),a("li",[e._v("If auth fails, finish with failed authentication")])]),e._v(" "),a("h1",{attrs:{id:"jaas-authorization-testing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jaas-authorization-testing","aria-hidden":"true"}},[e._v("#")]),e._v(" Jaas Authorization Testing")]),e._v(" "),a("p",[e._v("If you would like to test your Jaas configuration without restarting Rundeck every time you make a change to\nyour Jaas configuration, you can execute the command:")]),e._v(" "),a("pre",[a("code",[e._v("$ java -jar -Drundeck.jaaslogin=true -Dloginmodule.name=$LOGIN_MODULE_NAME -Drdeck.base=$RD_BASE_DIR rundeck.war --testauth\n\nex.\n\n$ java -jar -Drundeck.jaaslogin=true -Dloginmodule.name=RDpropertyfilelogin -Drdeck.base=/etc/rundeck rundeck.war --testauth\n$ Checking file: /etc/rundeck/server/config/jaas-loginmodule.conf\n$ Checking login module: RDpropertyfilelogin\n$ Enter user name: admin\n$ Enter password admin <-- This is masked in actual use\n$ Login Succeeded!\n")])]),e._v(" "),a("p",[e._v("The Jaas configuration file you are testing against will be printed out, along with the name of the login module you are testing.\nYou will be prompted to enter a username and password. These will be compared against your current Jaas configuration.\nIf the login is successful you will see: "),a("code",[e._v("Login Succeeded!")]),e._v("\nIf the login fails a stacktrace will be printed out which will contain the details about the failure.")]),e._v(" "),a("h1",{attrs:{id:"container-authentication-and-authorization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#container-authentication-and-authorization","aria-hidden":"true"}},[e._v("#")]),e._v(" Container authentication and authorization")]),e._v(" "),a("p",[e._v("Container Authentication provides the Servlet context used by Rundeck\nwith a few mechanisms to determine what roles the user has.")]),e._v(" "),a("dl",[a("dt",[a("code",[e._v("containerPrincipal")])]),e._v(" "),a("dd",[e._v('JAAS authentication modules define a "Principal"\nthat represents the authenticated user,\nand which can list the "roles" the user has.')]),e._v(" "),a("dt",[a("code",[e._v("container")])]),e._v(" "),a("dd",[e._v("The Container also provides a query mechanism "),a("code",[e._v("isUserInRole")]),e._v(".")])]),e._v(" "),a("p",[e._v("Both of these methods are used by default,\nalthough they can be disabled\nwith the following configuration flags in "),a("code",[e._v("rundeck-config.properties")]),e._v(":")]),e._v(" "),a("pre",[a("code",[e._v("rundeck.security.authorization.containerPrincipal.enabled=false\nrundeck.security.authorization.container.enabled=false\n")])]),e._v(" "),a("h1",{attrs:{id:"preauthenticated-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preauthenticated-mode","aria-hidden":"true"}},[e._v("#")]),e._v(" Preauthenticated Mode")]),e._v(" "),a("h2",{attrs:{id:"preauthenticated-mode-using-ajp-with-apache-and-tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preauthenticated-mode-using-ajp-with-apache-and-tomcat","aria-hidden":"true"}},[e._v("#")]),e._v(" Preauthenticated Mode using AJP with apache and tomcat")]),e._v(" "),a("dl",[a("dt",[a("code",[e._v("preauthenticated")])]),e._v(" "),a("dd",[e._v('"Preauthenticated" means that the Servlet Container (e.g. Tomcat)\nis not being used for authentication/authorization.\nThe user name and role list are provided to Rundeck\nfrom another system, usually a reverse proxy set up "in front"\nof the Rundeck web application, such as Apache HTTPD.\nRundeck accepts the "REMOTE_USER" as the username,\nand allows a configurable Request Attribute to contain\nthe list of user roles.')])]),e._v(" "),a("p",[a("strong",[e._v("Note")]),e._v(": If you use this method, make sure that "),a("em",[e._v("only")]),e._v(" your proxy\nhas direct access to the ports Rundeck is listening on\n(e.g. firewall them),\notherwise you are opening access to rundeck\nwithout requiring authentication.")]),e._v(" "),a("p",[e._v("This method can be enabled with this config in "),a("code",[e._v("rundeck-config.properties")]),e._v(":")]),e._v(" "),a("pre",[a("code",[e._v("rundeck.security.authorization.preauthenticated.enabled=true\nrundeck.security.authorization.preauthenticated.attributeName=REMOTE_USER_GROUPS\nrundeck.security.authorization.preauthenticated.delimiter=:\n")])]),e._v(" "),a("p",[e._v("This configuration requires some additional setup to enable:")]),e._v(" "),a("ol",[a("li",[e._v('Apache HTTPD and Tomcat must be configured to communicate so that a list of User Roles is sent to Tomcat as a request Attribute with the given "attributeName".')])]),e._v(" "),a("p",[e._v("For Tomcat and Apache HTTPd with "),a("code",[e._v("mod_proxy_ajp")]),e._v(", here are some additional instructions:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Modify the tomcat server.xml, and make sure to set "),a("code",[e._v('tomcatAuthentication="false"')]),e._v(" on the AJP connector:")]),e._v(" "),a("pre",[a("code",[e._v('<Connector port="8009" protocol="AJP/1.3" redirectPort="4440" tomcatAuthentication="false"/>\n')])])]),e._v(" "),a("li",[a("p",[e._v('Configure Apache to perform the necessary authentication, and to pass an environment variable named "REMOTE_USER_GROUPS", the value should be all colon-separated e.g.: "user:admin:ops" (or using the '),a("code",[e._v("delimiter")]),e._v(" you have configured.)")])])]),e._v(" "),a("p",[e._v("Here is an example using just "),a("code",[e._v("mod_proxy_ajp")]),e._v(", and passing a static list of roles. A real solution should use "),a("a",{attrs:{href:"https://www.adelton.com/apache/mod_lookup_identity/",target:"_blank",rel:"noopener noreferrer"}},[e._v("mod_lookup_identity"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("pre",[a("code",[e._v('<Location /rundeck>\n    ProxyPass  ajp://localhost:8009/rundeck\n\n    AuthType basic\n    AuthName "private area"\n    AuthBasicProvider file\n\n    AuthUserFile /etc/httpd/users.htpasswd\n    SetEnv AJP_REMOTE_USER_GROUPS "admin:testrole1:testrole2"\n    Require valid-user\n</Location>\n')])]),e._v(" "),a("p",[a("strong",[e._v("Note")]),e._v(": "),a("code",[e._v("mod_proxy_ajp")]),e._v(' requires prefixing the environment variable with "AJP_", but '),a("code",[e._v("mod_jk")]),e._v(" can pass the environment variable directly.")]),e._v(" "),a("p",[e._v('Once authenticated via Apache, you should be able to access rundeck.\nYou might see a page saying "You have no authorized access to projects",\nand then "(User roles: role1, role2, ...)"\nwith a list of all of the user roles seen by Rundeck.\nThis page just means that there are no aclpolicy files\nthat match those roles,\nbut the apache->tomcat authorization is still working correctly.\nAt this point, move on to '),a("router-link",{attrs:{to:"/administration/security/authorization.html"}},[e._v("Access Control Policy")]),e._v("\nto set up access control for the listed roles.")],1),e._v(" "),a("p",[e._v('If the "User roles: " part is blank, then it may not be working correctly.')]),e._v(" "),a("h2",{attrs:{id:"preauthenticated-mode-using-headers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preauthenticated-mode-using-headers","aria-hidden":"true"}},[e._v("#")]),e._v(" Preauthenticated Mode using headers")]),e._v(" "),a("p",[e._v("If you have a proxy sitting in front of your Rundeck installation that authenticates your users, you can send the authenticated user and groups to Rundeck via HTTP headers. Set the following properties in your "),a("code",[e._v("rundeck-config.properties")]),e._v(" file.")]),e._v(" "),a("pre",[a("code",[e._v("rundeck.security.authorization.preauthenticated.enabled=true\nrundeck.security.authorization.preauthenticated.attributeName=REMOTE_USER_GROUPS\nrundeck.security.authorization.preauthenticated.delimiter=,\nrundeck.security.authorization.preauthenticated.userNameHeader=X-Forwarded-Uuid\nrundeck.security.authorization.preauthenticated.userRolesHeader=X-Forwarded-Roles\n")])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("attributeName")]),e._v(" property is the name of the request attribute which stores the user groups for the request. The forwarded headers will be put into this attribute. This attribute must be set for this method to work properly.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("userNameHeader")]),e._v(" property is the name of the header from which to obtain the authenticated user name.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("userRolesHeader")]),e._v(" property is the name of the header from which to obtain the list of user roles. The roles should be delimited by\nthe delimiter specified in the "),a("code",[e._v("delimiter")]),e._v(" property.")]),e._v(" "),a("h2",{attrs:{id:"preauthenticated-mode-logout-redirection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preauthenticated-mode-logout-redirection","aria-hidden":"true"}},[e._v("#")]),e._v(" Preauthenticated mode logout redirection")]),e._v(" "),a("p",[e._v("If you are running preauthenticated mode and wish to redirect to a custom logout url on user logout, set the following properties:")]),e._v(" "),a("pre",[a("code",[e._v("# Redirect to upstream logout url\nrundeck.security.authorization.preauthenticated.redirectLogout=true\nrundeck.security.authorization.preauthenticated.redirectUrl=/customlogouturl\n")])])])},[],!1,null,null,null);t.default=r.exports}}]);