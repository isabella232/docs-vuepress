(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{427:function(e,t,a){"use strict";a.r(t);var r=a(0),s=Object(r.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"using-mysql-as-a-database-backend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-mysql-as-a-database-backend","aria-hidden":"true"}},[e._v("#")]),e._v(" Using MySQL as a database backend")]),e._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",[e._v("MySQL 5.7 or greater is recommended\nThis is a simple guide for setting up Mysql for use with Rundeck.")])]),e._v(" "),a("h2",{attrs:{id:"install-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Install MySQL")]),e._v(" "),a("p",[e._v('You can "yum install" or "apt-get install" the server, you can find installation guides for other OS '),a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/installing.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1)]),e._v(" "),a("h2",{attrs:{id:"configure-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure MySQL")]),e._v(" "),a("p",[e._v("After install, run the "),a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysql-secure-installation.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("mysql_secure_installation script"),a("OutboundLink")],1),e._v(". This will let prompt you to set the root password for mysql, as well as disable anonymous access.")]),e._v(" "),a("p",[e._v("Set an appropriate "),a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-buffer-pool-resize.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("innodb_buffer_pool_size"),a("OutboundLink")],1),e._v(". MySQL, like many databases, manages\nits own page cache and the buffer pool size determines how much RAM it can use! Setting this to 80% of the system memory is the common wisdom for dedicated\nservers, however you may want go higher if your server has more than 32G of RAM.")]),e._v(" "),a("h3",{attrs:{id:"mysql-5-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-5-6","aria-hidden":"true"}},[e._v("#")]),e._v(" MySQL 5.6")]),e._v(" "),a("p",[a("code",[e._v("5.6.3")]),e._v(" or greater is required if using "),a("code",[e._v("utf8mb4")]),e._v(" character set as the server default, and upgrading or installation may require an extra step.")]),e._v(" "),a("p",[e._v("Configuration:")]),e._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("innodb_file_format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("barracuda")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("innodb_file_per_table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("true")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("innodb_large_prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("true")]),e._v("\n")])])]),a("p",[e._v("After first Rundeck start run the following SQL queries:")]),e._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("use")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("rundeck_database"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ALTER")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("event_subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" ROW_FORMAT"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("dynamic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ALTER")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("reaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" ROW_FORMAT"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("dynamic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ALTER")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v("reaction_event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("`")]),e._v(" ROW_FORMAT"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("dynamic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Restart Rundeck!")]),e._v(" "),a("h2",{attrs:{id:"setup-rundeck-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup-rundeck-database","aria-hidden":"true"}},[e._v("#")]),e._v(" Setup Rundeck Database")]),e._v(" "),a("p",[e._v("Now you want to create a database and user access for the Rundeck server.")]),e._v(" "),a("p",[e._v('If it is not running, start mysqld with "service mysqld start"')]),e._v(" "),a("p",[e._v("Use the 'mysql' commandline tool to access the db as the root user:")]),e._v(" "),a("pre",[a("code",[e._v("$ mysql -u root -p\n")])]),e._v(" "),a("p",[e._v("Enter your root password to connect. Once you have the mysql> prompt, enter the following commands to create the rundeck database:")]),e._v(" "),a("pre",[a("code",[e._v("mysql> create database rundeck;\nQuery OK, 1 row affected (0.00 sec)\n")])]),e._v(" "),a("p",[e._v('Then "grant" access for a new user/password, and specify the hostname the Rundeck server will connect from. if it is the same server, you can use "localhost".')]),e._v(" "),a("pre",[a("code",[e._v("mysql> grant ALL on rundeck.* to 'rundeckuser'@'localhost' identified by 'rundeckpassword';\nQuery OK, 1 row affected (0.00 sec)\n")])]),e._v(" "),a("p",[e._v("You can then exit the mysql prompt.")]),e._v(" "),a("p",[e._v("Test access (if it's from localhost) by running:")]),e._v(" "),a("pre",[a("code",[e._v("$ mysql -u rundeckuser -p\n")])]),e._v(" "),a("p",[e._v('You can verify you can see the "rundeck" database with:')]),e._v(" "),a("pre",[a("code",[e._v("mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| rundeck            |\n+--------------------+\n2 rows in set (0.00 sec)\n")])]),e._v(" "),a("h2",{attrs:{id:"configure-rundeck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure Rundeck")]),e._v(" "),a("p",[e._v("Now you need to configure Rundeck to connect to this DB.")]),e._v(" "),a("p",[e._v("Update your "),a("code",[e._v("rundeck-config.properties")]),e._v(" and configure the datasource:")]),e._v(" "),a("ul",[a("li",[e._v("RPM/Debian location: "),a("code",[e._v("/etc/rundeck/rundeck-config.properties")])]),e._v(" "),a("li",[e._v("Launcher location: "),a("code",[e._v("$RDECK_BASE/server/config/rundeck-config.properties")])])]),e._v(" "),a("p",[e._v("Contents:")]),e._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataSource.url")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("jdbc:mysql://myserver/rundeck?autoReconnect=true&useSSL=false")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataSource.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("rundeckuser")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataSource.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("rundeckpassword")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataSource.driverClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("com.mysql.jdbc.Driver")]),e._v("\n")])])]),a("p",[e._v("Finally you can start rundeck. If you see a startup error about database access, make sure that the hostname that the Mysql server sees from the client is the same one you granted access to.")]),e._v(" "),a("p",[e._v("NB: "),a("code",[e._v("autoReconnect=true")]),e._v(' will fix a common problem where the Rundeck server\'s connection to Mysql is dropped after a period of inactivity, resulting in an error message: "Message: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost."')]),e._v(" "),a("p",[e._v("See more about "),a("a",{attrs:{href:"https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("configuring the Mysql JDBC Connector/J URL"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h1",{attrs:{id:"mysql-migration-guide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-migration-guide","aria-hidden":"true"}},[e._v("#")]),e._v(" Mysql migration guide")]),e._v(" "),a("p",[e._v("This section describes how to migrate a set of Rundeck projects from\nthe built-in H2 database, to use Mysql.")]),e._v(" "),a("h2",{attrs:{id:"project-export-all-projects"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#project-export-all-projects","aria-hidden":"true"}},[e._v("#")]),e._v(" Project export all projects")]),e._v(" "),a("p",[e._v("For each project you want to retain, Export the archive via the GUI:")]),e._v(" "),a("ul",[a("li",[e._v("Navigate to Configure page for the project\n"),a("ul",[a("li",[e._v("Either click the cog icon in the header, then choose your project from the list")]),e._v(" "),a("li",[e._v("OR click the Configure button next to the project name in the home page")])])]),e._v(" "),a("li",[e._v('Click on the "Export Archive" tab')]),e._v(" "),a("li",[e._v('Click "Export project.rdproject.jar"')]),e._v(" "),a("li",[e._v("Wait for export process to complete")]),e._v(" "),a("li",[e._v("Click the link to download the file")])]),e._v(" "),a("p",[e._v("Note: make sure to click the final link that is presented to download the file.")]),e._v(" "),a("p",[e._v('Save each project archive file (named "[project name]-XXXX.rdproject.jar")\nin a place you can upload it later.')]),e._v(" "),a("h2",{attrs:{id:"backup-your-rundeck-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backup-your-rundeck-data","aria-hidden":"true"}},[e._v("#")]),e._v(" Backup your Rundeck data")]),e._v(" "),a("ul",[a("li",[e._v("Make a backup of your Projects\n"),a("ul",[a("li",[e._v("RPM/Debian install location: "),a("code",[e._v("/var/rundeck/projects")])]),e._v(" "),a("li",[e._v("Launcher location: "),a("code",[e._v("$RDECK_BASE/prjoects")])])])]),e._v(" "),a("li",[e._v("Make a backup of your H2 database, which you can revert back to in case of error,\n"),a("ul",[a("li",[e._v("RPM/Debian install location: "),a("code",[e._v("/var/lib/rundeck/data")])]),e._v(" "),a("li",[e._v("Launcher location: "),a("code",[e._v("$RDECK_BASE/server/data")])])])])]),e._v(" "),a("h2",{attrs:{id:"stop-rundeck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stop-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Stop rundeck")]),e._v(" "),a("p",[e._v("Unix:")]),e._v(" "),a("pre",[a("code",[e._v("sudo service rundeckd stop\n")])]),e._v(" "),a("h2",{attrs:{id:"setup-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Setup mysql")]),e._v(" "),a("p",[e._v("Install Mysql according to the instructions for your platform.")]),e._v(" "),a("h2",{attrs:{id:"prepare-mysql-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-mysql-database","aria-hidden":"true"}},[e._v("#")]),e._v(" Prepare Mysql database")]),e._v(" "),a("p",[e._v("Perform this command to log in as root:")]),e._v(" "),a("pre",[a("code",[e._v("mysql -u root -p\n")])]),e._v(" "),a("p",[e._v("Then execute this sql:")]),e._v(" "),a("pre",[a("code",[e._v("> create database rundeck\n> grant ALL on rundeck.* to 'rundeckuser'@'localhost' identified by 'rundeckpassword'\n")])]),e._v(" "),a("h2",{attrs:{id:"configure-rundeck-config-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-rundeck-config-properties","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure rundeck-config.properties")]),e._v(" "),a("p",[e._v("Set the datasource URL to point to your Mysql host, with appropriate database name,\nusername and password.")]),e._v(" "),a("p",[e._v("See "),a("a",{attrs:{href:"#configure-rundeck"}},[e._v("Configure Rundeck")]),e._v(" above.")]),e._v(" "),a("h2",{attrs:{id:"configure-project-config-in-db"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-project-config-in-db","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure project config in DB")]),e._v(" "),a("p",[e._v("Enable DB storage for Project configurations, and Key Storage. Optionally enable encryption.")]),e._v(" "),a("p",[e._v("For more info refer to:")]),e._v(" "),a("ul",[a("li",[a("router-link",{attrs:{to:"/administration/security/key-storage.html"}},[e._v("Security - Key Storage")])],1),e._v(" "),a("li",[a("router-link",{attrs:{to:"/administration/configuration/plugins/bundled-plugins.html#jasypt-encryption-plugin"}},[e._v("Configuring Plugins - Bundled Plugins - Jasypt Encryption Plugin")])],1),e._v(" "),a("li",[a("router-link",{attrs:{to:"/administration/configuration/storage-facility.html"}},[e._v("Storage Facility")])],1)]),e._v(" "),a("h2",{attrs:{id:"start-up-rundeck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#start-up-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Start up Rundeck")]),e._v(" "),a("p",[e._v("Start the Rundeck server again.")]),e._v(" "),a("p",[e._v("Unix:")]),e._v(" "),a("pre",[a("code",[e._v("sudo service rundeckd start\n")])]),e._v(" "),a("p",[e._v('View the "/var/log/rundeck/service.log" file for any error messages.')]),e._v(" "),a("ul",[a("li",[e._v("Project definitions/configs will be imported to DB automatically")]),e._v(" "),a("li",[e._v("Resources.xml remain in the same location")])]),e._v(" "),a("h2",{attrs:{id:"import-archives"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import-archives","aria-hidden":"true"}},[e._v("#")]),e._v(" Import archives")]),e._v(" "),a("p",[e._v("For each project you wish to import, go to the Configure page for the project:")]),e._v(" "),a("ul",[a("li",[e._v('Click the "Import Archive" tab')]),e._v(" "),a("li",[e._v("Upload the project archive with the corresponding name")]),e._v(" "),a("li",[e._v("Optionally choose to Import All Executions")]),e._v(" "),a("li",[e._v("Click Import")])])])},[],!1,null,null,null);t.default=s.exports}}]);