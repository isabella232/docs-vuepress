(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{661:function(e,t,r){"use strict";r.r(t);var o=r(0),s=Object(o.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"configuring-ssl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configuring-ssl","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuring SSL")]),e._v(" "),r("p",[e._v("This document describes how to configure Rundeck for SSL/HTTPS support, and assumes you are using the rundeck-launcher standalone launcher. If you are using RPM/DEB install, refer to the appropriate configuration file paths from\n"),r("router-link",{attrs:{to:"/administration/configuration/config-file-reference.html#configuration-layout"}},[e._v("Rundeck Configuration - Configuration File Reference - Configuration Layout")]),e._v(".")],1),e._v(" "),r("p",[e._v("(1) Before beginning, do a first-run of the launcher, as it will create the base directory for Rundeck and generate configuration files.")]),e._v(" "),r("pre",[r("code",[e._v("    cd $RDECK_BASE;  java -jar rundeck-3.0.1.war\n")])]),e._v(" "),r("p",[e._v("This will start the server and generate necessary config files. Press control-c to shut down the server after you get below message from terminal:")]),e._v(" "),r("pre",[r("code",[e._v("Grails application running at http://localhost:4440 in environment: production\n")])]),e._v(" "),r("p",[e._v("(2) Using the "),r("a",{attrs:{href:"https://linux.die.net/man/1/keytool-java-1.6.0-openjdk",target:"_blank",rel:"noopener noreferrer"}},[e._v("keytool"),r("OutboundLink")],1),e._v(" command, generate a keystore for use as the server cert and client truststore. Specify passwords for key and keystore:")]),e._v(" "),r("pre",[r("code",[e._v("    keytool -keystore etc/keystore -alias rundeck -genkey -keyalg RSA -keypass adminadmin -storepass adminadmin\n")])]),e._v(" "),r("p",[e._v('Be sure to specify the correct hostname of the server as the response to the question "What is your first and last name?". Answer "yes" to the final question.')]),e._v(" "),r("p",[e._v("You can pass all the answers to the tool on the command-line by using a HERE document.")]),e._v(" "),r("p",[e._v('Replace the first line "Venkman.local" with the hostname for your server, and use any other organizational values you like:')]),e._v(" "),r("pre",[r("code",[e._v("        keytool -keystore etc/keystore -alias rundeck -genkey -keyalg RSA -keypass adminadmin -storepass adminadmin  <<!\n        Venkman.local\n        devops\n        My org\n        my city\n        my state\n        US\n        yes\n        !\n")])]),e._v(" "),r("p",[e._v("(3) CLI tools that communicate to the Rundeck server need to trust the SSL certificate provided by the server. They are preconfigured to look for a truststore at the location:\n"),r("code",[e._v("$RDECK_BASE/etc/truststore")]),e._v(". Copy the keystore as the truststore for CLI tools:")]),e._v(" "),r("pre",[r("code",[e._v("    cp etc/keystore etc/truststore\n")])]),e._v(" "),r("p",[e._v("(4) Modify the ssl.properties file to specify the full path location of the keystore and the appropriate passwords:")]),e._v(" "),r("pre",[r("code",[e._v("    vi server/config/ssl.properties\n")])]),e._v(" "),r("p",[e._v("An example ssl.properties file (from the RPM and DEB packages).")]),e._v(" "),r("pre",[r("code",[e._v("    keystore=/etc/rundeck/ssl/keystore\n    keystore.password=adminadmin\n    key.password=adminadmin\n    truststore=/etc/rundeck/ssl/truststore\n    truststore.password=adminadmin\n")])]),e._v(" "),r("p",[e._v("The ssl.properties default keystore and truststore location path for war installation is $RDECK_BASE/etc/")]),e._v(" "),r("p",[e._v("(5) Configure client properties. Modify the file\n"),r("code",[e._v("$RDECK_BASE/etc/framework.properties")]),e._v(" and change these properties:")]),e._v(" "),r("pre",[r("code",[e._v("* `framework.server.url`\n* `framework.rundeck.url`\n* `framework.server.port`\n")])]),e._v(" "),r("p",[e._v("Set them to the appropriate https protocol, and change the port to 4443, or to the value of your "),r("code",[e._v("-Dserver.https.port")]),e._v(" runtime configuration property.")]),e._v(" "),r("p",[e._v("(6) Configure server URL so that Rundeck knows its external address. Modify the file "),r("code",[e._v("$RDECK_BASE/server/config/rundeck-config.properties")]),e._v(" and change the "),r("code",[e._v("grails.serverURL")]),e._v(":")]),e._v(" "),r("pre",[r("code",[e._v("* `grails.serverURL=https://myhostname:4443`\n")])]),e._v(" "),r("p",[e._v("Set the URL to include the appropriate https protocol, and change the port to 4443, or to the value of your "),r("code",[e._v("-Dserver.https.port")]),e._v(" runtime configuration property.")]),e._v(" "),r("p",[e._v("(7) For Debian installation, create/edit "),r("code",[e._v("/etc/default/rundeckd")]),e._v(", for RPM installation, create/edit "),r("code",[e._v("/etc/sysconfig/rundeckd")]),e._v(":")]),e._v(" "),r("pre",[r("code",[e._v("    export RUNDECK_WITH_SSL=true\n    export RDECK_HTTPS_PORT=1234\n")])]),e._v(" "),r("p",[e._v("(8) Start the server. For the rundeck launcher, tell it where to read the ssl.properties")]),e._v(" "),r("pre",[r("code",[e._v(" java -Drundeck.ssl.config=$RDECK_BASE/server/config/ssl.properties -jar rundeck-3.0.1.war\n")])]),e._v(" "),r("p",[e._v("You can change port by adding "),r("code",[e._v("-Dserver.https.port")]),e._v(":")]),e._v(" "),r("pre",[r("code",[e._v(" java -Drundeck.ssl.config=$RDECK_BASE/server/config/ssl.properties -Dserver.https.port=1234 -jar rundeck-3.0.1.war\n")])]),e._v(" "),r("p",[e._v("If successful, you will see a line indicating the SSl connector has started:")]),e._v(" "),r("pre",[r("code",[e._v(" Grails application running at https://localhost:1234 in environment: production\n")])]),e._v(" "),r("h3",{attrs:{id:"securing-passwords"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#securing-passwords","aria-hidden":"true"}},[e._v("#")]),e._v(" Securing passwords")]),e._v(" "),r("p",[e._v("Passwords do not have to be stored in the ssl.config. If they are not set, then the server will prompt on the console for a user to enter the passwords.")]),e._v(" "),r("p",[e._v("If you want the server to start without prompting then you need to set the passwords in the config file.")]),e._v(" "),r("p",[e._v("The passwords stored in ssl.properties can be obfuscated so they are not in plaintext:")]),e._v(" "),r("p",[e._v('Run the jetty "Password" utility:')]),e._v(" "),r("pre",[r("code",[e._v("$ java -cp server/lib/jetty-all-7.6.0.v20120127.jar org.eclipse.jetty.util.security.Password [username] [password]\n")])]),e._v(" "),r("p",[e._v('This will produce two lines, one starting with "OBF:"')]),e._v(" "),r("p",[e._v("Use the entire OBF: output as the password in the ssl.properties file, eg:")]),e._v(" "),r("pre",[r("code",[e._v("key.password=OBF:1lk2j1lkj321lj13lj\n")])]),e._v(" "),r("h3",{attrs:{id:"troubleshooting-keystore"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-keystore","aria-hidden":"true"}},[e._v("#")]),e._v(" Troubleshooting keystore")]),e._v(" "),r("p",[e._v("Some common error messages and causes:")]),e._v(" "),r("dl",[r("dt",[e._v("java.io.IOException: Keystore was tampered with, or password was incorrect")]),e._v(" "),r("dd",[e._v("A password specified in the file was incorrect.")]),e._v(" "),r("dt",[e._v("2010-12-02 10:07:29.958::WARN: failed SslSocketConnector@0.0.0.0:4443: java.io.FileNotFoundException: /Users/greg/rundeck/etc/keystore (No such file or directory)")]),e._v(" "),r("dd",[e._v("The keystore/truststore file specified in ssl.properties doesn't exist")])]),e._v(" "),r("h3",{attrs:{id:"optional-pem-export"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#optional-pem-export","aria-hidden":"true"}},[e._v("#")]),e._v(" Optional PEM export")]),e._v(" "),r("p",[e._v("You can export the PEM formatted server certificate for use by HTTPS clients (web browsers or e.g. curl).")]),e._v(" "),r("p",[e._v("Export pem cacert for use by e.g. curl:")]),e._v(" "),r("pre",[r("code",[e._v("keytool -export -keystore etc/keystore -rfc -alias rundeck > rundeck.server.pem\n")])]),e._v(" "),r("h2",{attrs:{id:"using-an-ssl-terminated-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#using-an-ssl-terminated-proxy","aria-hidden":"true"}},[e._v("#")]),e._v(" Using an SSL Terminated Proxy")]),e._v(" "),r("p",[e._v("You can tell Jetty to honor\n"),r("code",[e._v("X-Forwarded-Proto")]),e._v(", "),r("code",[e._v("X-Forwarded-Host")]),e._v(",\n"),r("code",[e._v("X-Forwarded-Server")]),e._v(" and "),r("code",[e._v("X-Forwarded-For")]),e._v(" headers in two ways:")]),e._v(" "),r("p",[e._v("In "),r("router-link",{attrs:{to:"/administration/configuration/config-file-reference.html#rundeck-config.properties"}},[e._v("rundeck-config.properties")]),e._v(" you can set:")],1),e._v(" "),r("pre",[r("code",[e._v("server.useForwardHeaders=true\n")])]),e._v(" "),r("p",[e._v("Or by declaring the following JVM property:")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("rundeck.jetty.connector.forwarded")]),e._v(' set to "true" to enable proxy forwarded support.')])]),e._v(" "),r("p",[e._v("For the executable war you can specify it on the commandline "),r("code",[e._v("-Drundeck.jetty.connector.forwarded=true")]),e._v(".")]),e._v(" "),r("p",[e._v("For RPM/DEB install you can export the "),r("code",[e._v("RDECK_JVM_OPTS")]),e._v(" variable in the file "),r("code",[e._v("/etc/sysconfig/rundeckd")]),e._v(" (RPM) or "),r("code",[e._v("/etc/default/rundeckd")]),e._v(" (DEB) and add:")]),e._v(" "),r("pre",[r("code",[e._v("RDECK_JVM_OPTS=-Drundeck.jetty.connector.forwarded=true\n")])]),e._v(" "),r("p",[e._v("This will enable Jetty to respond correctly when a forwarded request is first received.")]),e._v(" "),r("p",[r("strong",[e._v("Note:")]),e._v(" You will still need to modify the "),r("code",[e._v("grails.serverURL")]),e._v(" value in "),r("router-link",{attrs:{to:"/administration/configuration/config-file-reference.html#rundeck-config.properties"}},[e._v("rundeck-config.properties")]),e._v(" to let Rundeck know how to properly generate absolute URLs.")],1),e._v(" "),r("h2",{attrs:{id:"disabling-ssl-protocols"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#disabling-ssl-protocols","aria-hidden":"true"}},[e._v("#")]),e._v(" Disabling SSL Protocols")]),e._v(" "),r("p",[e._v("You can disable SSL protocols or cipher suites using these JVM variables:")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("rundeck.jetty.connector.ssl.includedProtocols")]),e._v(" set to a comma-separated list of SSL protocols to enable. Default will be based on the available protocols.")]),e._v(" "),r("li",[r("code",[e._v("rundeck.jetty.connector.ssl.excludedProtocols")]),e._v(" set to a comma-separated list of SSL protocols to disable. Default value: 'SSLv3'")]),e._v(" "),r("li",[r("code",[e._v("rundeck.jetty.connector.ssl.includedCipherSuites")]),e._v(" set to a comma-separated list of Cipher suites to enable. Default will be based on the available cipher suites.")]),e._v(" "),r("li",[r("code",[e._v("rundeck.jetty.connector.ssl.excludedCipherSuites")]),e._v(" set to a comma-separated list of Cipher suites to disable. No default value.")])]),e._v(" "),r("p",[e._v("The "),r("code",[e._v("included")]),e._v(" settings determine what protocols or cipher suites are enabled, and the "),r("code",[e._v("excluded")]),e._v(" settings then remove values from that list.")]),e._v(" "),r("p",[e._v("E.g. modify the "),r("code",[e._v("RDECK_JVM")]),e._v(" variable in the file "),r("code",[e._v("/etc/rundeck/profile")]),e._v(" and add:")]),e._v(" "),r("pre",[r("code",[e._v("-Drundeck.jetty.connector.ssl.excludedProtocols=SSLv3,SSLv2Hello\n")])]),e._v(" "),r("p",[e._v("When starting up the Jetty container will log a list of the disabled protocols:")]),e._v(" "),r("pre",[r("code",[e._v("2014-10-27 11:08:41.225:INFO:oejus.SslContextFactory:Enabled Protocols [SSLv2Hello, TLSv1] of [SSLv2Hello, SSLv3, TLSv1]\n")])]),e._v(" "),r("p",[e._v("To see the list of enabled Cipher Suites, turn on DEBUG level logging for Jetty SSL utils: "),r("code",[e._v("-Dorg.eclipse.jetty.util.ssl.LEVEL=DEBUG")]),e._v(".")])])},[],!1,null,null,null);t.default=s.exports}}]);